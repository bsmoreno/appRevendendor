import{a3 as ls,a4 as f,a5 as F,a6 as P,a7 as z,a8 as H,a9 as ds,aa as us,ab as G,ac as cs,ad as ms,ae as hs,af as xs,ag as Z,ah as ps,ai as js,aj as gs,t as ss,ak as es,h as _,l as J,m as E,al as fs,am as _s,an as vs,U as b,p as D,ao as Cs,ap as Ss,j as s,a2 as bs,aq as ys,S as R,D as K,T as U,ar as i,as as c,at as h,au as y,av as x,aw as Us,a as Es,R as Rs,H as Bs,B as W,ax as Is,c as Ns}from"./index-BmfGJE-Y.js";import{A as As}from"./ArrowLeft-uFTLAPnv.js";import{O as p}from"./option-3-dWwJf-.js";import{P as ks}from"./react-number-format.es-BDYcYGAq.js";import{u as T}from"./usuario-state-CTeTsZho.js";import{r as $}from"./rotas-state-DjDFkAys.js";import{S as Q}from"./Select-CJvL_hJA.js";import{R as Ls,a as X}from"./RadioGroup-BY-t0YHY.js";import{F as Y}from"./FormControlLabel-HCwVRRhk.js";import{L as ws}from"./LoadingButton-gJW1zksJ.js";import"./SwitchBase-LEr907X7.js";const rs=async a=>{try{return gs(f([Z("E-mail Inválido")]),a).success?(await ss.get(`/Usuarios/v1/VerificarEmail?ds_Email=${encodeURIComponent(a)}`)).data:!1}catch{return!1}},Fs=ls({ds_Nome:f([F(1,"Informe o Nome"),P(255,"Máximo de 255 Caracteres"),z(),H()]),ds_Sobrenome:f([F(1,"Informe o Sobrenome"),P(255,"Máximo de 255 Caracteres"),z(),H()]),ds_Email:ds([F(1,"Informe o E-mail"),Z("E-mail Inválido"),P(255,"Máximo de 255 Caracteres"),ps(async a=>await rs(a),"E-mail já cadastrado"),js()]),nr_Celular:f([us(a=>{var n=a.replace(/[\D]/g,"");return n===""?!0:!(n.length!=13||n.substr(2).length!=11)},"Celular Inválido")]),tp_Admin:G("Informe o Admin"),tp_Status:G("Informe o Status"),js_Roles:cs(ms(hs([f(),xs()])),a=>a.filter(n=>n.type!==void 0).filter(n=>parseInt(n.type.split("_")[1])>=0).map(n=>n.type))}),Ps=()=>{const a=es(),[n,m]=_.useState(!1),[B,j]=J(T),[I,r]=J($),l=E(T),N=E($),[V,A]=fs();_.useEffect(()=>{const o=_s.map(ts);r(o)},[]);const k={ds_Nome:"",ds_Sobrenome:"",ds_Email:"",nr_Celular:"",tp_Admin:!1,tp_Status:!1,js_Roles:[]},{control:q,handleSubmit:L,register:M,trigger:w,setError:v,setValue:O,clearErrors:t,formState:{errors:d,isLoading:u,isValidating:C,isSubmitting:g}}=vs({mode:"onSubmit",reValidateMode:"onSubmit",defaultValues:k,resolver:Ss(Fs)}),S=_.useCallback(async o=>{try{if(o.js_Roles.length==0){b.error("Selecione ao menos uma permissão para prosseguir");return}let e=await ss.post("/Usuarios/v1/Criar",o);j({usuario:e.data,novoUsuario:!0}),e.status===200?(b.success(`Usuario Cadastrado Com Sucesso! - Senha: ${e.data.ds_Password}`),r([]),j({usuario:null,novoUsuario:!1}),a(D.dashboard.cadastros.usuarios.listar)):b.error("Falha ao Criar Usuário")}catch{b.error("Something went wrong!")}},[a]),as=async o=>{try{await rs(o.target.value)?t("ds_Email"):v("ds_Email",{type:"custom",message:"E-mail já cadastrado"})}catch(e){v("ds_Email",{type:"custom",message:e.message})}},ts=o=>{const e=o.startsWith("/")?o.substring(1).split("/"):o.split("/"),ns=e.length==2?e[0]:(e.length==3||e.length==4,e[1]),os=e.length==2?e[1]:e.length==3||e.length==4?e[2]:e[3];e.length>2?e[3]:e[2];const is=e.length==2?e[1]:e.length==3?e[2]:(e.length==4,e[3]);return{id:o,origem:ns,pasta:os,pagina:is,status:!1,permissoes:[[!1,0,"leitura"],[!1,1,"gravar"],[!1,2,"atualizar"],[!1,3,"excluir"],[!1,4,"admin"]]}};return _.useEffect(()=>{A(g||u)},[g,u]),{Controller:Cs,register:M,handleSubmit:L,handleEmailBlur:as,onSubmit:S,setError:v,setValue:O,clearErrors:t,trigger:w,control:q,errors:d,defaultValues:k,isLoading:u,isValidating:C,isSubmitting:g,resetNovoUsuario:l,resetRotas:N,novoUsuario:B,setNovoUsuario:j,rotas:I,setRotas:r,navigate:a,isChecking:n,setIsChecking:m}};function Ws(){var{Controller:a,register:n,handleSubmit:m,handleEmailBlur:B,setValue:j,onSubmit:I,errors:r,control:l,isSubmitting:N,resetNovoUsuario:V,resetRotas:A,novoUsuario:k,setNovoUsuario:q,rotas:L,setRotas:M,navigate:w,isChecking:v,setIsChecking:O}=Ps();return s.jsx("form",{onSubmit:m(I),children:s.jsxs(bs,{children:[s.jsx(ys,{children:s.jsx(R,{divider:s.jsx(K,{}),spacing:4,children:s.jsxs(R,{spacing:3,children:[s.jsx(U,{variant:"h6",children:"Informações Basicas"}),s.jsxs(i,{container:!0,spacing:3,children:[s.jsx(i,{md:6,xs:12,children:s.jsx(a,{control:l,name:"ds_Nome",render:({field:t})=>s.jsxs(c,{error:!!r.ds_Nome,fullWidth:!0,children:[s.jsx(h,{required:!0,children:"Nome"}),s.jsx(y,{inputProps:{style:{textTransform:"uppercase"}},...t}),r.ds_Nome?s.jsx(x,{children:r.ds_Nome.message}):null]})})}),s.jsx(i,{md:6,xs:12,children:s.jsx(a,{control:l,name:"ds_Sobrenome",render:({field:t})=>s.jsxs(c,{error:!!r.ds_Sobrenome,fullWidth:!0,children:[s.jsx(h,{required:!0,children:"Sobrenome"}),s.jsx(y,{inputProps:{style:{textTransform:"uppercase"}},...t}),r.ds_Sobrenome?s.jsx(x,{children:r.ds_Sobrenome.message}):null]})})}),s.jsx(i,{md:6,xs:12,children:s.jsx(a,{control:l,name:"ds_Email",render:({field:t})=>s.jsxs(c,{error:!!r.ds_Email,fullWidth:!0,children:[s.jsx(h,{required:!0,children:"E-mail"}),s.jsx(y,{...t,inputProps:{style:{textTransform:"lowercase"}},onBlur:d=>{t.onBlur(),B(d)}}),r.ds_Email?s.jsx(x,{children:r.ds_Email.message}):null]})})}),s.jsx(i,{md:6,xs:12,children:s.jsx(a,{control:l,name:"nr_Celular",render:({field:t})=>s.jsxs(c,{error:!!r.nr_Celular,fullWidth:!0,children:[s.jsx(h,{required:!0,children:"Celular"}),s.jsx(ks,{name:"nr_Celular",format:"+55 (##) #.####-####","aria-label":"Telefone",type:"tel",onChange:d=>{j("nr_Celular",d.target.value)},customInput:y}),r.nr_Celular?s.jsx(x,{children:r.nr_Celular.message}):null]})})}),s.jsx(i,{md:6,xs:12,children:s.jsx(a,{control:l,name:"tp_Admin",render:({field:t})=>s.jsxs(c,{error:!!r.tp_Admin,fullWidth:!0,children:[s.jsx(h,{children:"Admin"}),s.jsxs(Q,{...t,children:[s.jsx(p,{value:"",children:"---"}),s.jsx(p,{value:"true",children:"Sim"}),s.jsx(p,{value:"false",children:"Não"})]}),r.tp_Admin?s.jsx(x,{error:!0,children:r.tp_Admin.message}):null]})})}),s.jsx(i,{md:6,xs:12,children:s.jsx(a,{control:l,name:"tp_Status",render:({field:t})=>s.jsxs(c,{error:!!r.tp_Status,fullWidth:!0,children:[s.jsx(h,{children:"Status"}),s.jsxs(Q,{...t,children:[s.jsx(p,{value:"",children:"---"}),s.jsx(p,{value:"true",children:"Sim"}),s.jsx(p,{value:"false",children:"Não"})]}),r.tp_Status?s.jsx(x,{error:!0,children:r.tp_Status.message}):null]})})}),s.jsx(i,{md:12,xs:12,children:s.jsxs(c,{error:!!r.js_Roles,fullWidth:!0,children:[s.jsx(U,{variant:"h3",sx:{marginBottom:"1%"},children:"Permissões"}),s.jsx(K,{sx:{marginBottom:"2%"}}),L.map((t,d)=>s.jsxs(i,{container:!0,spacing:2,mb:2,children:[s.jsx(i,{md:6,xs:6,children:s.jsx(U,{children:t.id.substring(1).replaceAll("/"," > ").toLocaleUpperCase()})}),s.jsx(i,{md:6,xs:6,children:s.jsx(a,{control:l,name:`js_Roles.[${d}].type`,render:({field:u})=>(u.value===void 0&&(u.value=`${t.id}_-1`),s.jsxs(Ls,{row:!0,...u,children:[s.jsx(Y,{control:s.jsx(X,{}),value:`${t.id}_-1`,label:"SEM ACESSO"}),t.permissoes.map((C,g)=>{var S;return s.jsx(Y,{control:s.jsx(X,{}),value:`${t.id}_${C[1]}`,label:(S=C[2].toString())==null?void 0:S.toLocaleUpperCase()},g)})]}))})})]},d))]})})]})]})})}),s.jsxs(Us,{sx:{justifyContent:"flex-end"},children:[s.jsx(Es,{color:"secondary",component:Rs,onClick:()=>{V(),A(),w(D.dashboard.cadastros.usuarios.listar)},children:"Cancelar"}),s.jsx(ws,{type:"submit",loadingIndicator:"Salvando...",loading:N,variant:"outlined",children:"Cadastrar Usuário"})]})]})})}const Ts={title:`Criar | Usuários | Dashboard | ${Ns.site.name}`};function Ys(){const a=es(),n=E(T),m=E($);return s.jsxs(_.Fragment,{children:[s.jsx(Bs,{children:s.jsx("title",{children:Ts.title})}),s.jsx(W,{sx:{maxWidth:"var(--Content-maxWidth)",m:"var(--Content-margin)",p:"var(--Content-padding)",width:"var(--Content-width)"},children:s.jsxs(R,{spacing:4,children:[s.jsxs(R,{spacing:3,children:[s.jsx(W,{children:s.jsxs(Is,{color:"text.primary",onClick:()=>{n(),m(),a(D.dashboard.cadastros.usuarios.listar)},sx:{alignItems:"center",display:"inline-flex",gap:1},variant:"subtitle2",children:[s.jsx(As,{fontSize:"var(--icon-fontSize-md)"}),"Usuários"]})}),s.jsx(W,{children:s.jsx(U,{variant:"h4",children:"Criar Novo Usuário"})})]}),s.jsx(Ws,{})]})})]})}export{Ys as Page};
