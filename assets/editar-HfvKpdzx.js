import{a3 as fe,a4 as j,ay as de,a5 as X,a6 as Y,a7 as Z,a8 as ee,az as ge,aa as _e,ab as se,ac as ve,ad as Se,ae as be,af as Ce,aA as ye,ak as ue,h as u,l as D,m as U,G as Ue,al as Ee,aj as Re,U as x,p as y,J as Ie,t as re,am as Ae,an as Ne,ao as Be,ap as ke,j as e,a2 as Fe,aq as Le,S as ae,D as te,T as $,ar as l,as as p,at as S,au as q,av as b,aw as qe,a as $e,R as Pe,aB as We,H as Te,B as z,ax as we,c as De}from"./index-BmfGJE-Y.js";import{O as C}from"./option-3-dWwJf-.js";import{P as ze}from"./react-number-format.es-BDYcYGAq.js";import{u as V}from"./usuario-state-CTeTsZho.js";import{r as O}from"./rotas-state-DjDFkAys.js";import{S as ne}from"./Select-CJvL_hJA.js";import{R as Ve,a as oe}from"./RadioGroup-BY-t0YHY.js";import{F as ie}from"./FormControlLabel-HCwVRRhk.js";import{L as Oe}from"./LoadingButton-gJW1zksJ.js";import{A as Qe}from"./ArrowLeft-uFTLAPnv.js";import{S as le}from"./Stack-BwF0Qp1t.js";import"./SwitchBase-LEr907X7.js";const Ke=fe({id_Usuario:j("Id Inválido",[de("Id Inválido")]),ds_Nome:j([X(1,"Informe o Nome"),Y(255,"Máximo de 255 Caracteres"),Z(),ee()]),ds_Email:ge(j()),ds_Sobrenome:j([X(1,"Informe o Sobrenome"),Y(255,"Máximo de 255 Caracteres"),Z(),ee()]),nr_Celular:j([_e(i=>{var a=i.replace(/[\D]/g,"");return a===""?!0:!(a.length!=13||a.substr(2).length!=11)},"Celular Inválido")]),tp_Admin:se("Informe o Admin",[]),tp_Status:se("Informe o Status",[]),js_Roles:ve(Se(be([j(),Ce()])),i=>i.filter(a=>a.type!==void 0).filter(a=>parseInt(a.type.split("_")[1])>=0).map(a=>a.type))}),Q=ye({key:"usuarioEditarState",default:void 0}),Me=i=>{const a=ue(),[f,c]=u.useState(!1),[E,P]=D(V),[t,d]=D(O),[s,N]=D(Q),g=U(V),_=U(O),R=U(Q),B=Ue(),[K,M]=Ee();u.useEffect(()=>{const n=Re(j([de()]),i);if(i===void 0||!n.success){x.error("Id de Usuário Inválido"),B.removeQueries({queryKey:["UsuariosEditar",i],exact:!0}),a(y.dashboard.cadastros.usuarios.listar);return}},[i]);const{data:k,isLoading:v,error:G,isFetching:F}=Ie({queryKey:["UsuariosEditar",i],queryFn:async()=>{try{const n=await re.get("Usuarios/v1/Buscar",{params:{id_Usuario:i}});return n.status===200?(N(n.data),n.data):(x.error("Usuário não encontrado"),B.removeQueries({queryKey:["UsuariosEditar",i],exact:!0}),g(),_(),R(),a(y.dashboard.cadastros.usuarios.listar),null)}catch{return x.error("Erro ao buscar usuário"),B.removeQueries({queryKey:["UsuariosEditar",i],exact:!0}),g(),_(),R(),a(y.dashboard.cadastros.usuarios.listar),null}},enabled:!!i,staleTime:60*1e3});u.useEffect(()=>{v&&A({id_Usuario:"",ds_Nome:"",ds_Sobrenome:"",nr_Celular:"",ds_Email:"",tp_Admin:!1,tp_Status:!1,js_Roles:[]})},[v]);const W={id_Usuario:"",ds_Nome:"",ds_Sobrenome:"",nr_Celular:"",ds_Email:"",tp_Admin:!1,tp_Status:!1,js_Roles:[]};u.useEffect(()=>{if(s===void 0)return;const n=Ae.map(xe);d(n)},[s]),u.useEffect(()=>{if(c(!0),s===void 0&&s===void 0)return;let n=[];for(let h=0;h<t.length;h++){var r=t[h];Object.keys(s.js_Roles).includes(t[h].id)?n.push({type:`${r.id}_${s.js_Roles[t[h].id]}`}):n.push({type:`${r.id}_-1`})}A({id_Usuario:s==null?void 0:s.id_Usuario,ds_Nome:s==null?void 0:s.ds_Nome,ds_Sobrenome:s==null?void 0:s.ds_Sobrenome,nr_Celular:(s==null?void 0:s.nr_Celular.length)==13?s==null?void 0:s.nr_Celular.substring(2):"",ds_Email:s==null?void 0:s.ds_Email,tp_Admin:s==null?void 0:s.tp_Admin,tp_Status:s==null?void 0:s.tp_Status,js_Roles:n}),c(!1)},[t,s]);const{control:H,handleSubmit:J,register:o,trigger:m,setError:I,setValue:L,clearErrors:T,reset:A,watch:Je,formState:{errors:ce,isValidating:me,isSubmitting:w}}=Ne({mode:"onSubmit",reValidateMode:"onSubmit",defaultValues:W,resolver:ke(Ke)}),he=u.useCallback(async n=>{try{if(n.js_Roles.length==0){x.error("Selecione ao menos uma permissão para prosseguir");return}(await re.put("/Usuarios/v1/Editar",n)).status===200?(x.success("Usuario Atualizado Com Sucesso!"),g(),_(),R(),a(y.dashboard.cadastros.usuarios.listar)):x.error("Falha ao Atualizar Usuário")}catch{x.error("Something went wrong!")}},[a]),xe=n=>{const r=n.startsWith("/")?n.substring(1).split("/"):n.split("/"),h=r.length==2?r[0]:(r.length==3||r.length==4,r[1]),pe=r.length==2?r[1]:r.length==3||r.length==4?r[2]:r[3];r.length>2?r[3]:r[2];const je=r.length==2?r[1]:r.length==3?r[2]:(r.length==4,r[3]);return{id:n,origem:h,pasta:pe,pagina:je,status:!1,permissoes:[[!1,0,"leitura"],[!1,1,"gravar"],[!1,2,"atualizar"],[!1,3,"excluir"],[!1,4,"admin"]]}};return u.useEffect(()=>{M(w||v||F||f)},[w,v,F,f]),{Controller:Be,register:o,handleSubmit:J,onSubmit:he,setError:I,setValue:L,clearErrors:T,trigger:m,control:H,errors:ce,defaultValues:W,isLoading:v,isValidating:me,isSubmitting:w,resetNovoUsuario:g,resetRotas:_,resetUsuarios:R,novoUsuario:E,setNovoUsuario:P,rotas:t,setRotas:d,usuario:s,setUsuario:N,navigate:a,isChecking:f,setIsChecking:c,isFetching:F}};function Ge({id_Usuario:i}){var{Controller:a,register:f,handleSubmit:c,setValue:E,onSubmit:P,errors:t,control:d,isSubmitting:s,resetNovoUsuario:N,resetRotas:g,resetUsuarios:_,novoUsuario:R,setNovoUsuario:B,rotas:K,setRotas:M,usuario:k,setUsuario:v,navigate:G,isChecking:F,setIsChecking:W,isFetching:H,isLoading:J}=Me(i);return e.jsx("form",{onSubmit:c(P),children:e.jsxs(Fe,{children:[e.jsx(Le,{children:e.jsx(ae,{divider:e.jsx(te,{}),spacing:4,children:e.jsxs(ae,{spacing:3,children:[e.jsx($,{variant:"h6",children:"Informações Basicas"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{md:6,xs:12,children:e.jsx(a,{control:d,name:"ds_Nome",render:({field:o})=>e.jsxs(p,{error:!!t.ds_Nome,fullWidth:!0,children:[e.jsx(S,{required:!0,children:"Nome"}),e.jsx(q,{...o,inputProps:{style:{textTransform:"uppercase"}}}),t.ds_Nome?e.jsx(b,{children:t.ds_Nome.message}):null]})})}),e.jsx(l,{md:6,xs:12,children:e.jsx(a,{control:d,name:"ds_Sobrenome",render:({field:o})=>e.jsxs(p,{error:!!t.ds_Sobrenome,...o,fullWidth:!0,children:[e.jsx(S,{required:!0,children:"Sobrenome"}),e.jsx(q,{...o,inputProps:{style:{textTransform:"uppercase"}}}),t.ds_Sobrenome?e.jsx(b,{children:t.ds_Sobrenome.message}):null]})})}),e.jsx(l,{md:6,xs:12,children:e.jsx(a,{control:d,name:"ds_Email",disabled:!0,render:({field:o})=>e.jsxs(p,{error:!!t.ds_Email,fullWidth:!0,children:[e.jsx(S,{required:!0,children:"E-mail"}),e.jsx(q,{...o,inputProps:{style:{textTransform:"lowercase"}}}),t.ds_Email?e.jsx(b,{children:t.ds_Email.message}):null]})})}),e.jsx(l,{md:6,xs:12,children:e.jsx(a,{control:d,name:"nr_Celular",render:({field:o})=>e.jsxs(p,{error:!!t.nr_Celular,fullWidth:!0,children:[e.jsx(S,{required:!0,children:"Celular"}),e.jsx(ze,{name:"nr_Celular",format:"+55 (##) #.####-####","aria-label":"Telefone",type:"tel",value:k==null?void 0:k.nr_Celular,onChange:m=>{E("nr_Celular",m.target.value)},customInput:q}),t.nr_Celular?e.jsx(b,{children:t.nr_Celular.message}):null]})})}),e.jsx(l,{md:6,xs:12,children:e.jsx(a,{control:d,name:"tp_Admin",render:({field:o})=>e.jsxs(p,{error:!!t.tp_Admin,fullWidth:!0,children:[e.jsx(S,{children:"Admin"}),e.jsxs(ne,{...o,children:[e.jsx(C,{value:null,children:"---"},1),e.jsx(C,{value:"true",children:"Sim"},2),e.jsx(C,{value:"false",children:"Não"},3)]}),t.tp_Admin?e.jsx(b,{children:t.tp_Admin.message}):null]})})}),e.jsx(l,{md:6,xs:12,children:e.jsx(a,{control:d,name:"tp_Status",render:({field:o})=>e.jsxs(p,{error:!!t.tp_Status,fullWidth:!0,children:[e.jsx(S,{children:"Status"}),e.jsxs(ne,{...o,children:[e.jsx(C,{value:"",children:"---"},1),e.jsx(C,{value:"true",children:"Sim"},2),e.jsx(C,{value:"false",children:"Não"},3)]}),t.tp_Status?e.jsx(b,{children:t.tp_Status.message}):null]})})}),e.jsx(l,{md:12,xs:12,children:e.jsxs(p,{error:!!t.js_Roles,fullWidth:!0,children:[e.jsx($,{variant:"h3",sx:{marginBottom:"1%"},children:"Permissões"}),e.jsx(te,{sx:{marginBottom:"2%"}}),K.map((o,m)=>e.jsxs(l,{container:!0,spacing:2,mb:2,children:[e.jsx(l,{md:6,xs:6,children:e.jsx($,{children:o.id.substring(1).replaceAll("/"," > ").toLocaleUpperCase()})}),e.jsx(l,{md:6,xs:6,children:e.jsx(a,{control:d,name:`js_Roles.[${m}].type`,render:({field:I})=>(I.value===void 0&&(I.value=`${o.id}_-1`),e.jsxs(Ve,{row:!0,...I,children:[e.jsx(ie,{control:e.jsx(oe,{}),value:`${o.id}_-1`,label:"SEM ACESSO"}),o.permissoes.map((L,T)=>{var A;return e.jsx(ie,{control:e.jsx(oe,{}),value:`${o.id}_${L[1]}`,label:(A=L[2].toString())==null?void 0:A.toLocaleUpperCase()},T)})]},m))})})]},m))]})})]})]})})}),e.jsxs(qe,{sx:{justifyContent:"flex-end"},children:[e.jsx($e,{color:"secondary",component:Pe,onClick:()=>{G(y.dashboard.cadastros.usuarios.listar),g(),N(),_()},children:"Cancelar"}),e.jsx(Oe,{type:"submit",loadingIndicator:"Salvando...",loading:s,variant:"outlined",children:"Salvar Usuário"})]})]})})}const He={title:`Detalhes | Usuários | Dashboard | ${De.site.name}`};function cs(){var{id:i}=We();const a=ue(),f=U(V),c=U(O),E=U(Q);return e.jsxs(u.Fragment,{children:[e.jsx(Te,{children:e.jsx("title",{children:He.title})}),e.jsx(z,{sx:{maxWidth:"var(--Content-maxWidth)",m:"var(--Content-margin)",p:"var(--Content-padding)",width:"var(--Content-width)"},children:e.jsxs(le,{spacing:4,children:[e.jsxs(le,{spacing:3,children:[e.jsx(z,{children:e.jsxs(we,{color:"text.primary",onClick:()=>{f(),c(),E(),a(y.dashboard.cadastros.usuarios.listar)},sx:{alignItems:"center",display:"inline-flex",gap:1},variant:"subtitle2",children:[e.jsx(Qe,{fontSize:"var(--icon-fontSize-md)"}),"Usuários"]})}),e.jsx(z,{children:e.jsx($,{variant:"h4",children:"Editar Usuário"})})]}),e.jsx(Ge,{id_Usuario:i})]})})]})}export{cs as Page};
